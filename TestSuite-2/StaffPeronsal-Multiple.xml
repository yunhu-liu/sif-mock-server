<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="daf6f6ef-70a9-4c8b-b435-9dfc0a03bb68" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="StaffPeronsal-Multiple" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="334dca71-4bfe-4984-b721-9f54387e6445fileName">StaffPeronsal-Multiple</con:setting>
    <con:setting id="daf6f6ef-70a9-4c8b-b435-9dfc0a03bb68fileName">StaffPeronsal-Multiple</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="properties" name="Properties 1" id="c89ed620-272c-44ac-aa23-6c40fd8a29c9">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>Count</con:name>
          <con:value>34</con:value>
        </con:property>
        <con:property>
          <con:name>StaffPersonalRefId</con:name>
          <con:value>8d01b07b-9757-4b35-9c62-1053b26fe7c0</con:value>
        </con:property>
        <con:property>
          <con:name>StaffPersonalLocalId</con:name>
          <con:value>T98001</con:value>
        </con:property>
        <con:property>
          <con:name>SchoolSMSUserId</con:name>
          <con:value>SmythR</con:value>
        </con:property>
        <con:property>
          <con:name>FamilyName</con:name>
          <con:value>Smyth</con:value>
        </con:property>
        <con:property>
          <con:name>GivenName</con:name>
          <con:value>Riley</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="datasource" name="LoadTestData-Multiple" id="fb6f502c-b02a-4167-be81-e8ac509155a1">
    <con:settings>
      <con:setting id="com.eviware.soapui.impl.wsdl.teststeps.datasource.DataSourceContainer@prepared-properties">&lt;xml-fragment/></con:setting>
    </con:settings>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="Directory">
        <con:configuration>
          <directory>C:/TeRito APIs/Te Rito APIs (v3.2-rc2)/v3.2-rc2_multiple_header_wrapped/StaffPersonal/200</directory>
          <filter>200_StaffPersonal_TeWheke_8005_multiple_valid_.json</filter>
          <encoding/>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>TestData</con:property>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:restartOnRun>true</con:restartOnRun>
    </con:config>
  </con:testStep>
  <con:testStep type="datasource" name="GetPayload" id="ef081864-68a8-4f9f-bd4a-83f5ca99da83">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="JSON">
        <con:configuration>
          <sourceStep>LoadTestData-Multiple</sourceStep>
          <sourceProperty>TestData</sourceProperty>
          <rowPath>$['testcase']</rowPath>
          <columnPath/>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>Payload</con:property>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:restartOnRun>true</con:restartOnRun>
    </con:config>
  </con:testStep>
  <con:testStep type="datasource" name="GenDynamicId" id="c7716133-d608-47dd-aee5-fcc3846cb5a3">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="Data Generator">
        <con:configuration>
          <generatedDataCount>1</generatedDataCount>
          <generatorsTotalNumber>1</generatorsTotalNumber>
          <lastSelectedProperty>0</lastSelectedProperty>
          <GeneratorType0>STR</GeneratorType0>
          <PropertyName0>DynamicId</PropertyName0>
          <repetitionCountDynamicId>0</repetitionCountDynamicId>
          <repeatValuesDynamicId>false</repeatValuesDynamicId>
          <PasswordDataGeneratorUseSpacesDynamicId>false</PasswordDataGeneratorUseSpacesDynamicId>
          <PasswordDataGeneratorUsePunctuationMarksDynamicId>false</PasswordDataGeneratorUsePunctuationMarksDynamicId>
          <PasswordDataGeneratorUseLettersDynamicId>true</PasswordDataGeneratorUseLettersDynamicId>
          <PasswordDataGeneratorUseDigitsDynamicId>true</PasswordDataGeneratorUseDigitsDynamicId>
          <PasswordDataGeneratorMaxCharacterCountDynamicId>8</PasswordDataGeneratorMaxCharacterCountDynamicId>
          <PasswordDataGeneratorMinCharacterCountDynamicId>8</PasswordDataGeneratorMinCharacterCountDynamicId>
          <escapeSpaceSequence/>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>DynamicId</con:property>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:restartOnRun>true</con:restartOnRun>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="UpdatePayload" id="6cdb9029-2de0-48ec-86e4-6b060931fa90">
    <con:settings/>
    <con:config>
      <script>// Update Payload by Adding Dynamic Values to Some Fields
import groovy.json.*

// Load Data
def orgRefId = context.expand( '${#Project#OrgRefId}' )
def payload = context.expand( '${GetPayload#Payload}' ) 
def slurped = new JsonSlurper().parseText(payload)

// Get Total Count
def spCount = slurped.StaffPersonals.StaffPersonal.size()

// Loop Through and Update Fields for Each
for ( i = 0; i &lt; spCount; i++)
{
	def staffPersonalLocalId = slurped.StaffPersonals.StaffPersonal[i].StaffPersonalLocalId
	
	// Update Fields
	slurped.StaffPersonals.StaffPersonal[i].PersonInfo.Email.Work.SourceOrganisation.RefId = "$orgRefId"
	slurped.StaffPersonals.StaffPersonal[i] &lt;&lt; 
	[StaffAssignment: [
		StaffAssignmentLocalId: "$staffPersonalLocalId" + "_" + "$orgRefId",
          StaffRole: "1002",
          StartDate: "2020-09-03T00:00:00+1200"  
          ]
	]
}

// Set Values to Property
testRunner.testCase.testSteps["Properties 1"].setPropertyValue( "Count", spCount.toString() )
testRunner.testCase.testSteps["Properties 1"].setPropertyValue( "StaffPersonalLocalId", slurped.StaffPersonals.StaffPersonal[0].StaffPersonalLocalId )
testRunner.testCase.testSteps["Properties 1"].setPropertyValue( "SchoolSMSUserId", slurped.StaffPersonals.StaffPersonal[0].SchoolSMSUserId )
testRunner.testCase.testSteps["Properties 1"].setPropertyValue( "FamilyName", slurped.StaffPersonals.StaffPersonal[0].PersonInfo.Name.FamilyName )
testRunner.testCase.testSteps["Properties 1"].setPropertyValue( "GivenName", slurped.StaffPersonals.StaffPersonal[0].PersonInfo.Name.GivenName )

// Write Updated Payload to Result
return new JsonBuilder(slurped)</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="CreateStaffPersonals" id="fae5b501-31af-4808-99a9-ee05e7deb294">
    <con:settings/>
    <con:config service="Te Rito APIs" resourcePath="/staffpersonal" methodName="createStaffPersonals" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="CreateStaffPersonals" id="8ad11654-9dc8-4653-8756-767b6028da86" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://northern.edsby.co.nz/sif</con:endpoint>
        <con:request>${UpdatePayload#result}</con:request>
        <con:originalUri>http://mocksifapi.terito.education.govt.nz/sif/staffpersonal</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="5694bccc-94b5-4906-83d2-b6f19efc46cb" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>401</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="MessageContentAssertion" id="fd720be0-292b-4cd4-a53b-caf8150429c2" name="Message Content Assertion">
          <con:configuration xsi:type="con:MessageContentAssertion">
            <con:elements>
              <con:xpath>//data[1]</con:xpath>
              <con:element>data</con:element>
              <con:type xsi:nil="true"/>
              <con:operator>contains</con:operator>
              <con:enabled>true</con:enabled>
              <con:expectedValue>${#Project#Error401}</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentType</con:xpath>
              <con:element>@contentType</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>null</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentLength</con:xpath>
              <con:element>@contentLength</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>134</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:originalMessage>&lt;data contentType="null" contentLength="134">&lt;![CDATA[{
  "error": 401,
  "when": "2021-03-01T23:23:40.5775559+00:00",
  "errorstr": "Unauthorised request: Authorization Header missing."
}]]&gt;&lt;/data></con:originalMessage>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Accept" value="${#Project#Accept}"/>
          <con:entry key="X-Edsby-APIClientId" value="${#Project#ApiClientId}"/>
          <con:entry key="X-Edsby-OrganisationRefId" value="${#Project#OrgRefId}"/>
          <con:entry key="x-http-method-override" value=""/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="02e1b66e-5963-4de7-b043-dcb6acc71d67">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="GetStaffPersonals" id="d37df545-d80f-47ae-ba84-352de5528811">
    <con:settings/>
    <con:config service="Te Rito APIs" resourcePath="/staffpersonal" methodName="getStaffPersonals" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="GetStaffPersonals" id="3c8ebaad-a898-4cfe-9890-8dfd20326c04" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://northern.edsby.co.nz/sif</con:endpoint>
        <con:request/>
        <con:originalUri>http://mocksifapi.terito.education.govt.nz/sif/staffpersonal</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="6a2dd70c-1802-49da-b00f-cc767f9a2937" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>401</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="MessageContentAssertion" id="dd7f4eda-f477-421b-a133-a3b6accb238a" name="Message Content Assertion">
          <con:configuration xsi:type="con:MessageContentAssertion">
            <con:elements>
              <con:xpath>//data[1]</con:xpath>
              <con:element>data</con:element>
              <con:type xsi:nil="true"/>
              <con:operator>contains</con:operator>
              <con:enabled>true</con:enabled>
              <con:expectedValue>${#Project#Error401}</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentType</con:xpath>
              <con:element>@contentType</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>null</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentLength</con:xpath>
              <con:element>@contentLength</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>134</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:originalMessage>&lt;data contentType="null" contentLength="134">&lt;![CDATA[{
  "error": 401,
  "when": "2021-03-01T23:23:40.6272733+00:00",
  "errorstr": "Unauthorised request: Authorization Header missing."
}]]&gt;&lt;/data></con:originalMessage>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Accept" value="${#Project#Accept}"/>
          <con:entry key="field" value=""/>
          <con:entry key="max" value=""/>
          <con:entry key="X-Edsby-APIClientId" value="${#Project#ApiClientId}"/>
          <con:entry key="pattern" value=""/>
          <con:entry key="X-Edsby-OrganisationRefId" value="${#Project#OrgRefId}"/>
          <con:entry key="page" value=""/>
          <con:entry key="sort" value=""/>
          <con:entry key="fields" value=""/>
          <con:entry key="human" value=""/>
          <con:entry key="unwrap" value=""/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="02e1b66e-5963-4de7-b043-dcb6acc71d67">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="UpdateStaffPeronals" id="9721e5ee-5e4b-4bfc-830c-92df38197a18">
    <con:settings/>
    <con:config service="Te Rito APIs" resourcePath="/staffpersonal" methodName="updateStaffPersonals" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="UpdateStaffPeronals" id="805f81c7-e274-471b-9d10-65c904295cc6" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://northern.edsby.co.nz/sif</con:endpoint>
        <con:request>${#[TestSuite 1#StudentPersonal-Multiple#UpdatePayload 2]#result}</con:request>
        <con:originalUri>http://mocksifapi.terito.education.govt.nz/sif/staffpersonal</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="8f7e8a31-236f-4b1e-9a47-f0500d39be22" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>401</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="MessageContentAssertion" id="5919ed19-339e-4dea-bc92-a1c4dae674fa" name="Message Content Assertion">
          <con:configuration xsi:type="con:MessageContentAssertion">
            <con:elements>
              <con:xpath>//data[1]</con:xpath>
              <con:element>data</con:element>
              <con:type xsi:nil="true"/>
              <con:operator>contains</con:operator>
              <con:enabled>true</con:enabled>
              <con:expectedValue>${#Project#Error401}</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentType</con:xpath>
              <con:element>@contentType</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>null</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentLength</con:xpath>
              <con:element>@contentLength</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>134</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:originalMessage>&lt;data contentType="null" contentLength="134">&lt;![CDATA[{
  "error": 401,
  "when": "2021-03-01T23:23:40.6842254+00:00",
  "errorstr": "Unauthorised request: Authorization Header missing."
}]]&gt;&lt;/data></con:originalMessage>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Accept" value="${#Project#Accept}"/>
          <con:entry key="X-Edsby-APIClientId" value="${#Project#ApiClientId}"/>
          <con:entry key="X-Edsby-OrganisationRefId" value="${#Project#OrgRefId}"/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="02e1b66e-5963-4de7-b043-dcb6acc71d67">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="PatchStaffPersonals" id="4273c48c-7345-44b2-bb4e-74a3871705d1">
    <con:settings/>
    <con:config service="Te Rito APIs" resourcePath="/staffpersonal" methodName="patchStaffPersonals" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="PatchStaffPersonals" id="9766a434-c180-45c0-bebc-e859808a1f2e" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://northern.edsby.co.nz/sif</con:endpoint>
        <con:request>${#[TestSuite 1#StudentPersonal-Multiple#UpdatePayload 3]#result}</con:request>
        <con:originalUri>http://mocksifapi.terito.education.govt.nz/sif/staffpersonal</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="310708e0-0740-4dac-a5d1-af7f08e57dd3" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>401</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="MessageContentAssertion" id="92014afc-5a07-4a33-9df1-3ad1f4a2c16f" name="Message Content Assertion">
          <con:configuration xsi:type="con:MessageContentAssertion">
            <con:elements>
              <con:xpath>//data[1]</con:xpath>
              <con:element>data</con:element>
              <con:type xsi:nil="true"/>
              <con:operator>contains</con:operator>
              <con:enabled>true</con:enabled>
              <con:expectedValue>${#Project#Error401}</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentType</con:xpath>
              <con:element>@contentType</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>null</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:elements>
              <con:xpath>//data[1]/@contentLength</con:xpath>
              <con:element>@contentLength</con:element>
              <con:type/>
              <con:operator>=</con:operator>
              <con:enabled>false</con:enabled>
              <con:expectedValue>134</con:expectedValue>
              <con:numberType>false</con:numberType>
            </con:elements>
            <con:originalMessage>&lt;data contentType="null" contentLength="134">&lt;![CDATA[{
  "error": 401,
  "when": "2021-03-01T23:23:40.7561602+00:00",
  "errorstr": "Unauthorised request: Authorization Header missing."
}]]&gt;&lt;/data></con:originalMessage>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Accept" value="${#Project#Accept}"/>
          <con:entry key="X-Edsby-APIClientId" value="${#Project#ApiClientId}"/>
          <con:entry key="X-Edsby-OrganisationRefId" value="${#Project#OrgRefId}"/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="02e1b66e-5963-4de7-b043-dcb6acc71d67">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>e5e4dfe1-c4c8-4fb7-a93c-8fbeb91651f9</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>40d5d932-171d-41b2-a1d8-476e7cb0da4a</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
